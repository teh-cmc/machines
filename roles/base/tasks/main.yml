---
- name: Copy pacman configuration file
  copy:
    src: pacman.conf
    dest: /etc/pacman.conf

- name: Refresh pacman mirrors
  pacman:
    update_cache: yes

- name: Install inetutils for hostname
  pacman:
      name: inetutils
      state: present

- name: Set the hostname
  hostname:
    name: "{{ hostname }}"
  when: hostname is defined

- name: Set kernel parameters
  lineinfile: "dest=/boot/loader/entries/arch.conf
              regexp=^options
              state=present
              line='options \"{{ kernel_parameters }}\"'"
  when: kernel_parameters is defined and bootloader == 'systemd-boot'
  tags:
    - kernelparams

- include: shell.yml
- include: user.yml
- include: sudo.yml
- include: packages.yml
- include: journal.yml
